{"version":3,"sources":["../../../../src/components/animation/NumberAnimation.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { cn } from '@/utils/cn';\r\nimport React, { useCallback, useEffect, useRef, useState } from 'react';\r\n\r\ninterface NumberAnimationProps {\r\n  number: number;\r\n  speed?: number;\r\n  interval?: number;\r\n  rooms?: number;\r\n  space?: number | null;\r\n  symbol?: boolean;\r\n  className?: string;\r\n  showPercentage?: boolean;\r\n  heightSpaceRatio?: number;\r\n  fontStyle?: React.CSSProperties;\r\n  threshold?: number;\r\n  rootMargin?: string;\r\n  children?: React.ReactNode;\r\n}\r\n\r\nconst NumberAnimation: React.FC<NumberAnimationProps> = ({\r\n  number,\r\n  speed = 800,\r\n  interval = 150,\r\n  rooms = 2,\r\n  space = null,\r\n  symbol = false,\r\n  className = '',\r\n  showPercentage = false,\r\n  heightSpaceRatio = 2.2,\r\n  fontStyle = {},\r\n  threshold = 0.5,\r\n  rootMargin = '0px 0px -50px 0px',\r\n  children,\r\n}) => {\r\n  const elementRef = useRef<HTMLDivElement>(null);\r\n  const [isAnimated, setIsAnimated] = useState(false);\r\n\r\n  const animate = (element: HTMLElement, properties: Record<string, string>, duration: number) => {\r\n    const startTime = performance.now();\r\n    const startValues: Record<string, number> = {};\r\n\r\n    // Get initial values\r\n    Object.keys(properties).forEach((prop) => {\r\n      const computedStyle = getComputedStyle(element);\r\n      startValues[prop] = parseFloat(computedStyle.getPropertyValue(prop)) || 0;\r\n    });\r\n\r\n    const animateFrame = (currentTime: number) => {\r\n      const elapsed = currentTime - startTime;\r\n      const progress = Math.min(elapsed / duration, 1);\r\n\r\n      // Easing function (ease-out)\r\n      const easeProgress = 1 - Math.pow(1 - progress, 3);\r\n\r\n      Object.keys(properties).forEach((prop) => {\r\n        const startValue = startValues[prop];\r\n        const endValue = parseFloat(properties[prop]);\r\n        const currentValue = startValue + (endValue - startValue) * easeProgress;\r\n        element.style.setProperty(prop, currentValue + (prop === 'top' ? 'px' : ''));\r\n      });\r\n\r\n      if (progress < 1) {\r\n        requestAnimationFrame(animateFrame);\r\n      }\r\n    };\r\n\r\n    requestAnimationFrame(animateFrame);\r\n  };\r\n\r\n  const initAnimation = useCallback(() => {\r\n    if (!elementRef.current || isAnimated) {\r\n      return;\r\n    }\r\n\r\n    const element = elementRef.current;\r\n    const targetNumber = number;\r\n\r\n    // Get the original text content to check for percentage from children or current content\r\n    const originalText = children ? String(children) : element.textContent || '';\r\n    const hasPercentageInOriginal = originalText.includes('%');\r\n\r\n    // Use inherit by default to respect parent styles\r\n    const defaultFontStyle: React.CSSProperties = {\r\n      fontSize: 'inherit',\r\n      color: 'inherit',\r\n      ...fontStyle,\r\n    };\r\n\r\n    // Calculate single digit width\r\n    element.style.display = 'flex';\r\n    element.style.alignItems = 'center';\r\n    element.style.fontSize = defaultFontStyle.fontSize as string;\r\n    element.style.color = 'rgba(0,0,0,0)';\r\n    element.textContent = targetNumber.toString();\r\n\r\n    const _height = element.offsetHeight;\r\n    const calculatedSpace = space || _height / heightSpaceRatio;\r\n    element.innerHTML = '';\r\n\r\n    // Create number HTML\r\n    let numberHtml = '';\r\n    for (let i = 0; i < 10; i++) {\r\n      const styleProps = Object.keys(defaultFontStyle)\r\n        .map((key) => `${key.replace(/([A-Z])/g, '-$1').toLowerCase()}: inherit`)\r\n        .join('; ');\r\n\r\n      numberHtml += `<span style=\"display: block; width: ${calculatedSpace}px; height: ${_height}px; line-height: ${_height}px; ${styleProps}\">${i}</span>`;\r\n    }\r\n\r\n    numberHtml = `<div class=\"_number\" style=\"width: ${calculatedSpace}px; height: ${_height}px; line-height: ${_height}px; display: flex; align-items: center;\"><div style=\"position: relative; width: ${calculatedSpace}px; height: ${_height}px; overflow: hidden;\"><div style=\"position: absolute; width: 100%;\">${numberHtml}</div></div></div>`;\r\n\r\n    // Process number\r\n    let numArr = String(targetNumber).split('');\r\n    const hasPercentage = showPercentage || hasPercentageInOriginal;\r\n    const _fillZero = !!rooms;\r\n\r\n    if (_fillZero) {\r\n      if (String(targetNumber).indexOf('.') !== -1) {\r\n        rooms++;\r\n      }\r\n      for (let i = numArr.length; i < rooms; i++) {\r\n        numArr.unshift('0');\r\n      }\r\n    }\r\n\r\n    if (symbol) {\r\n      // Handle thousand separator\r\n      const appendHtml: string[] = [];\r\n      const styleProps = Object.keys(defaultFontStyle)\r\n        .map((key) => `${key.replace(/([A-Z])/g, '-$1').toLowerCase()}: inherit`)\r\n        .join('; ');\r\n\r\n      const symbolHtml = `<span style=\"display: block; width: ${calculatedSpace}px; height: ${_height}px; line-height: ${_height}px; text-align: center; ${styleProps}\">,</span>`;\r\n      const dotHtml = `<span style=\"display: block; width: ${calculatedSpace}px; height: ${_height}px; line-height: ${_height}px; text-align: center; ${styleProps}\">.</span>`;\r\n\r\n      const symbolDiv = `<div class=\"_number\" style=\"width: ${calculatedSpace}px; height: ${_height}px; line-height: ${_height}px; display: flex; justify-content: center; align-items: center;\"><div style=\"position: relative; width: ${calculatedSpace}px; height: ${_height}px; overflow: hidden;\"><div style=\"position: absolute; width: 100%;\">${symbolHtml}</div></div></div>`;\r\n      const dotDiv = `<div class=\"_number\" style=\"width: ${calculatedSpace}px; height: ${_height}px; line-height: ${_height}px; display: flex; justify-content: center; align-items: center;\"><div style=\"position: relative; width: ${calculatedSpace}px; height: ${_height}px; overflow: hidden;\"><div style=\"position: absolute; width: 100%;\">${dotHtml}</div></div></div>`;\r\n\r\n      const numarr = String(targetNumber).split('.');\r\n      const re = /(-?\\d+)(\\d{3})/;\r\n      while (re.test(numarr[0])) {\r\n        numarr[0] = numarr[0].replace(re, '$1,$2');\r\n      }\r\n      numArr = (numarr.length > 1 ? numarr[0] + '.' + numarr[1] : numarr[0]).split('');\r\n\r\n      for (let i = 0; i < numArr.length; i++) {\r\n        if (isNaN(Number(numArr[i]))) {\r\n          if (numArr[i] === '.') {\r\n            appendHtml.push(dotDiv);\r\n          } else {\r\n            appendHtml.push(symbolDiv);\r\n          }\r\n        } else {\r\n          appendHtml.push(numberHtml);\r\n        }\r\n      }\r\n      element.innerHTML = appendHtml.join('');\r\n    } else {\r\n      element.innerHTML = numberHtml.repeat(rooms);\r\n\r\n      // Handle decimal point\r\n      if (String(targetNumber).indexOf('.') !== -1) {\r\n        const numberElements = element.querySelectorAll('._number');\r\n        const dotIndex = String(targetNumber).indexOf('.');\r\n        if (numberElements[dotIndex]) {\r\n          const spans = numberElements[dotIndex].querySelectorAll('span');\r\n          if (spans[0]) {\r\n            spans[0].innerHTML = '.';\r\n          }\r\n        }\r\n      }\r\n\r\n      // Handle percentage symbol\r\n      if (hasPercentage) {\r\n        const percentageSpan = document.createElement('span');\r\n        percentageSpan.textContent = '%';\r\n        percentageSpan.style.marginLeft = '2px';\r\n        element.appendChild(percentageSpan);\r\n      }\r\n    }\r\n\r\n    // Apply font styles\r\n    Object.keys(defaultFontStyle).forEach((key) => {\r\n      const cssKey = key.replace(/([A-Z])/g, '-$1').toLowerCase();\r\n      element.style.setProperty(cssKey, defaultFontStyle[key as keyof React.CSSProperties] as string);\r\n    });\r\n\r\n    // Animate numbers\r\n    const domArr = element.querySelectorAll('._number');\r\n\r\n    for (let i = 0; i < domArr.length; i++) {\r\n      setTimeout(\r\n        (dom, n) => {\r\n          const innerDiv = dom.children[0].children[0] as HTMLElement;\r\n          animate(\r\n            innerDiv,\r\n            {\r\n              top: -_height * Number(n) + 'px',\r\n            },\r\n            speed,\r\n          );\r\n        },\r\n        interval * (domArr.length - i),\r\n        domArr[i],\r\n        numArr[i],\r\n      );\r\n    }\r\n\r\n    setIsAnimated(true);\r\n  }, [\r\n    isAnimated,\r\n    number,\r\n    speed,\r\n    interval,\r\n    rooms,\r\n    space,\r\n    symbol,\r\n    showPercentage,\r\n    heightSpaceRatio,\r\n    fontStyle,\r\n    children,\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    const element = elementRef.current;\r\n    if (!element) {\r\n      return;\r\n    }\r\n\r\n    const observer = new IntersectionObserver(\r\n      (entries) => {\r\n        entries.forEach((entry) => {\r\n          if (entry.isIntersecting && !isAnimated) {\r\n            initAnimation();\r\n          }\r\n        });\r\n      },\r\n      {\r\n        threshold,\r\n        rootMargin,\r\n      },\r\n    );\r\n\r\n    observer.observe(element);\r\n\r\n    return () => {\r\n      observer.unobserve(element);\r\n    };\r\n  }, [isAnimated, threshold, rootMargin, initAnimation]);\r\n\r\n  return (\r\n    <span ref={elementRef} className={cn('inline-block', className)} style={fontStyle}>\r\n      {children || number}\r\n    </span>\r\n  );\r\n};\r\n\r\nNumberAnimation.displayName = 'NumberAnimation';\r\n\r\nexport default NumberAnimation;\r\n"],"names":[],"mappings":"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"}